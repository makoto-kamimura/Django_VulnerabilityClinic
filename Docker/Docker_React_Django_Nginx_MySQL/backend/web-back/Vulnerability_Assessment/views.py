from django.shortcuts import render
from django.conf import settings
from django.http import JsonResponse

# 他プロセス呼び出し_bash実行用
import subprocess, sys

# Create your views here.
def main(request):
    return render(request, 'Vulnerability_Assessment/main.html', {})

# index
def index(request):
    return render(request, 'Vulnerability_Assessment/index.html', {})

def ajax_number(request):
    number1 = int(request.POST.get('number1'))
    number2 = int(request.POST.get('number2'))
    plus = number1 + number2
    minus = number1 - number2
    d = {
        'plus': plus,
        'minus': minus,
    }
    return JsonResponse(d)

# test
def test(request):
    return render(request, 'Vulnerability_Assessment/test.html', {})

def ajax_Vulnerability_Assessment(request):
    assessment = str(request.POST.get('assessment'))

    # 実装予定_validation_for_IPaddress

    # bash実行
    try:
        bashhh = subprocess.run(assessment, shell=True, check=True, encoding='utf-8', stderr=subprocess.PIPE, stdout=subprocess.PIPE, universal_newlines=True)

    # エラー処理
    except subprocess.CalledProcessError:
        print('kamimura1: Failed to execute the external program.', file=sys.stderr)

    if bashhh.returncode != 0:
        print('kamimura2: ls failed.', file=sys.stderr)
        sys.exit(1)
        # 実装予定_output_for_logfile

    d = {
        'assessment': str(bashhh.stdout),
    }

    return JsonResponse(d)